`ssh jian@52.142.194.25`
`Yc912300////`
scp gpu-test.py jian@52.142.194.25:/home/jian/setup
scp csn-master.zip jian@52.142.194.25:/datadrive
scp jian@52.142.194.25:/datadrive/csn/parser/build/csn-languages.so ./

### run

cd /datadrive/

# sync my code

sudo rm -rf CodeSearchNet/code
cp -r CodeSearchNet/src CodeSearchNet/code

# scp terminal

`scp -r code jian@52.142.194.25:/datadrive/`
`Yc912300////`

# ssh terminal

cp -rf code/. CodeSearchNet/code

# delete data

`cd CodeSearchNet/resources/data/`
`find . -name 'contexts.csv' -print | xargs sudo rm`
`find . -name 'counters.pkl' -print | xargs sudo rm`

# clone this repository

`git clone https://github.com/github/CodeSearchNet.git`
cd /datadrive/CodeSearchNet/

# download data (~3.5GB) from S3; build and run the Docker container

`script/setup`

# enter screen

screen

# this will drop you into the shell inside a Docker container

script/console

# optional: log in to W&B to see your training metrics, track your experiments, and submit your models to the benchmark

`wandb login`

# switch the working dir from src to code

pip install tree_sitter

cd ../code/

<!-- python wow.py -->

python train.py --model alon ../resources/saved_models ../resources/data/python/final/jsonl/train ../resources/data/python/final/jsonl/valid ../resources/data/python/final/jsonl/test

# verify your setup by training a tiny model

python train.py --testrun

# see other command line options, try a full training run with default values,

# and explore other model variants by extending this baseline script

python train.py --help
python train.py

python train.py --model neuralbow
python train.py --model 1dcnn
python train.py --model rnn
python train.py --model selfatt
python train.py --model convselfatt

# generate predictions for model evaluation

python predict.py -r github/CodeSearchNet/0123456 # this is the org/project_name/run_id

# tmp log

```
2020-04-13 18:04:15.206419: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2020-04-13 18:04:15.283509: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties:
name: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235
pciBusID: 2095:00:00.0
totalMemory: 11.17GiB freeMemory: 11.11GiB
2020-04-13 18:04:15.283551: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0
2020-04-13 18:04:15.549066: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-04-13 18:04:15.549121: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0
2020-04-13 18:04:15.549133: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N
2020-04-13 18:04:15.549242: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10762 MB memory) -> physical GPU (device: 0, name: Tesla K80, pci bus id: 2095:00:00.0, compute capability: 3.7)
Tokenizing and building vocabulary for code snippets and queries.  This step may take several hours.
Loaded terminal token size: 12895
Loaded nonterminal token size: 7
contexts
(?, ?)
sparse_contexts
(200, 3)
WARNING:tensorflow:From /usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/sparse_ops.py:1165: sparse_to_dense (from tensorflow.python.ops.sparse_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Create a `tf.sparse.SparseTensor` and use `tf.sparse.to_dense` instead.
dense_contexts
(200, 3)
dense_contexts
(200, 3)
context_str
(200, 1)
flat_context_str
(200,)
context_tokens
(?, ?)
max_length
()
sparse_tokens
(200, ?)
dense_tokens
(200, ?)
dense_tokens
(200, 5)
token_ids
(200, 5)
token_lengths
(200,)
source_ids
(200, 5)
source_lengths
(200,)
context_str
(200, 1)
flat_context_str
(200,)
context_tokens
(?, ?)
max_length
()
sparse_tokens
(200, 9)
dense_tokens
(200, 9)
token_ids
(200, 9)
token_lengths
(200,)
middle_ids
(200, 9)
middle_lengths
(200,)
context_str
(200, 1)
flat_context_str
(200,)
context_tokens
(?, ?)
max_length
()
sparse_tokens
(200, ?)
dense_tokens
(200, ?)
dense_tokens
(200, 5)
token_ids
(200, 5)
token_lengths
(200,)
target_ids
(200, 5)
target_lengths
(200,)
context_mask
(200,)
terminal_token
(12895, 128)
nonterminal_token
(7, 128)
source_embed
(?, 200, 5, 128)
middle_embed
(?, 200, 9, 128)
target_embed
(?, 200, 5, 128)
source_mask
(?, 200, 5, 1)
target_mask
(?, 200, 5, 1)
source_token_sum
(?, 200, 128)
max_contexts
()
flat_paths
(?, 9, 128)
flat_context_mask
(?,)
lengths
(?,)
rnn_final_state
(?, 256)
middle_aggregation
(?, ?, 256)
target_token_sum
(?, 200, 128)
context_embed
(?, 200, 512)
context_embed
(?, 200, 512)
flat_embed
(?, 384)
transform_param
(384, 128)
flat_embed
(?, 128)
attention_param
(128, 1)
contexts_weights
(?, 1)
batched_contexts_weights
(?, 200, 1)
mask
(?, 200)
mask
(?, 200, 1)
batched_contexts_weights
(?, 200, 1)
attention_weights
(?, 200, 1)
batched_embed
(?, 200, 128)
code_vectors
(?, 128)
Starting training run alon-2020-04-13-18-03-58 of model AlonModel with following hypers:
{'code_rnn_hidden_dim': 64, 'code_rnn_dropout_keep_rate': 0.8, 'code_alon_pool_mode': 'alon_final', 'query_token_vocab_size': 10000, 'query_token_vocab_count_threshold': 10, 'query_token_embedding_size': 128, 'query_use_subtokens': False, 'query_mark_subtoken_end': False, 'query_max_num_tokens': 30, 'query_use_bpe': True, 'query_pct_bpe': 0.5, 'query_rnn_num_layers': 2, 'query_rnn_hidden_dim': 64, 'query_rnn_cell_type': 'LSTM', 'query_rnn_is_bidirectional': True, 'query_rnn_dropout_keep_rate': 0.8, 'query_rnn_recurrent_dropout_keep_rate': 1.0, 'query_rnn_pool_mode': 'weighted_mean', 'batch_size': 1000, 'optimizer': 'Adam', 'seed': 0, 'dropout_keep_rate': 0.9, 'learning_rate': 0.01, 'learning_rate_code_scale_factor': 1.0, 'learning_rate_query_scale_factor': 1.0, 'learning_rate_decay': 0.98, 'momentum': 0.85, 'gradient_clip': 1, 'loss': 'softmax', 'margin': 1, 'max_epochs': 300, 'patience': 5, 'fraction_using_func_name': 0.1, 'min_len_func_name_for_query': 12, 'query_random_token_frequency': 0.0, 'code_max_num_tokens': 200, 'code_use_subtokens': False, 'code_mark_subtoken_end': True}
Loading training and validation data.
Begin Training.
Training on 412178 python samples.
Validating on 23107 python samples.
==== Epoch 0 ====
Traceback (most recent call last):amples). Processed 0 samples. Loss so far: 0.0000.  MRR so far: 0.0000
  File "train.py", line 196, in <module>
    run_and_debug(lambda: run(args), args['--debug'])
  File "/usr/local/lib/python3.6/dist-packages/dpu_utils/utils/debughelper.py", line 21, in run_and_debug
    func()
  File "train.py", line 196, in <lambda>
    run_and_debug(lambda: run(args), args['--debug'])
  File "train.py", line 182, in run
    parallelize=not(arguments['--sequential']))
  File "train.py", line 94, in run_train
    model_path = model.train(train_data, valid_data, azure_info_path, quiet=quiet, resume=resume)
  File "/home/dev/code/models/model.py", line 838, in train
    quiet=quiet)
  File "/home/dev/code/models/model.py", line 776, in __run_epoch_in_batches
    op_results = self.__sess.run(ops_to_run, feed_dict=batch_data_dict)
  File "/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py", line 929, in run
    run_metadata_ptr)
  File "/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py", line 1128, in _run
    str(subfeed_t.get_shape())))
ValueError: Cannot feed value of shape (0,) for Tensor 'sample_loss_weights:0', which has shape '(1000,)'
```

# xx

rawurl,NameStore|Assign|body|Assign|NameStore,dom
rawurl,NameStore|Assign|body|Assign|Call|NameLoad,parse|string
rawurl,NameStore|Assign|body|Assign|Call|NameLoad,xml|data
rawurl,NameStore|Assign|body|For|NameStore,node
rawurl,NameStore|Assign|body|For|Call|AttributeLoad|NameLoad,dom
rawurl,NameStore|Assign|body|For|body|Assign|NameStore,url
rawurl,NameStore|Assign|body|Return|NameLoad,rawurl
dom,NameStore|Assign|Call|NameLoad,parse|string
dom,NameStore|Assign|Call|NameLoad,xml|data
dom,NameStore|Assign|body|For|NameStore,node
dom,NameStore|Assign|body|For|Call|AttributeLoad|NameLoad,dom
dom,NameStore|Assign|body|For|body|Assign|NameStore,url
dom,NameStore|Assign|body|Return|NameLoad,rawurl
parse|string,NameLoad|Call|NameLoad,xml|data
parse|string,NameLoad|Call|Assign|body|For|NameStore,node
parse|string,NameLoad|Call|Assign|body|For|Call|AttributeLoad|NameLoad,dom
parse|string,NameLoad|Call|Assign|body|For|body|Assign|NameStore,url
parse|string,NameLoad|Call|Assign|body|Return|NameLoad,rawurl
xml|data,NameLoad|Call|Assign|body|For|NameStore,node
xml|data,NameLoad|Call|Assign|body|For|Call|AttributeLoad|NameLoad,dom
xml|data,NameLoad|Call|Assign|body|For|body|Assign|NameStore,url
xml|data,NameLoad|Call|Assign|body|Return|NameLoad,rawurl
node,NameStore|For|Call|AttributeLoad|NameLoad,dom
node,NameStore|For|body|Assign|NameStore,url
node,NameStore|For|body|Return|NameLoad,rawurl
dom,NameLoad|AttributeLoad|Call|For|body|Assign|NameStore,url
dom,NameLoad|AttributeLoad|Call|For|body|Return|NameLoad,rawurl
url,NameStore|Assign|SubscriptLoad|Index|Num,NUM
url,NameStore|Assign|body|Expr|Call|AttributeLoad|NameLoad,rawurl
url,NameStore|Assign|body|For|body|Return|NameLoad,rawurl
node,NameLoad|AttributeLoad|Call|SubscriptLoad|Index|Num,NUM
rawurl,NameLoad|AttributeLoad|Call|AttributeLoad|SubscriptLoad|AttributeLoad|NameLoad,url
rawurl,NameLoad|AttributeLoad|Call|AttributeLoad|SubscriptLoad|Index|Num,NUM
url,NameLoad|AttributeLoad|SubscriptLoad|Index|Num,NUM
@@@@@@@@@terminal_counterrror_num:0
Counter({'rawurl': 17, 'dom': 14, 'url': 11, 'node': 8, 'parse': 7, 'string': 7, 'xml': 7, 'data': 7, 'NUM': 4})
@@@@@@@@@nonterminal_counter
Counter({'NameLoad': 34, 'Assign': 33, 'NameStore': 30, 'body': 30, 'Call': 24, 'For': 18, 'AttributeLoad': 15, 'Return': 7, 'SubscriptLoad': 5, 'Index': 4, 'Num': 4, 'Expr': 1})

# yy

(module (function_definition name: (identifier) parameters: (parameters (identifier)) body: (block (expression_statement (assignment left: (expression_list (identifier)) right: (expression_list (list)))) (expression_statement (assignment left: (expression_list (identifier)) right: (expression_list (call function: (identifier) arguments: (argument_list (identifier)))))) (for_statement left: (variables (identifier)) right: (expression_list (call function: (attribute object: (identifier) attribute: (identifier)) arguments: (argument_list (string)))) body: (block (expression_statement (assignment left: (expression_list (identifier)) right: (expression_list (subscript value: (call function: (attribute object: (identifier) attribute: (identifier)) arguments: (argument_list (string))) subscript: (integer))))) (expression_statement (call function: (attribute object: (identifier) attribute: (identifier)) arguments: (argument_list (attribute object: (subscript value: (attribute object: (identifier) attribute: (identifier)) subscript: (integer)) attribute: (identifier))))))) (return_statement (expression_list (identifier))))))
